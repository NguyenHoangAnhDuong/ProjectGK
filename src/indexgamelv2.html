<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../style/styleIndex/styleIndex.css">
    <link rel="shortcut icon" href="../image/Logo_HCMUAF.svg" type="image/x-icon">
    <title>Pong Ping</title>
</head>

<body>
    <div id="Templete">
        <div class="underPanel underPanelLeft">
        </div>
        <div class="underPanel underPanelRight">
        </div>
        <div class="iconDecorate iconDecorate-left">
            <div>
                <div>
                    <div>
                        <div>
                            <div>
                                <div>
                                    <div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="iconDecorate iconDecorate-right">
            <div>
                <div>
                    <div>
                        <div>
                            <div>
                                <div>
                                    <div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="GamingMachine">
            <div id="LeftArea">
                <canvas id="Score" width="" height=""></canvas>
                <div id="PanelControl">
                    <div id="BtnControl">
                        <div class="direction top" id="btnTop"><i class=" btnicon fa-solid fa-circle-up"></i></div>
                        <div class="direction right" id="btnRight"><i class="btnicon fa-solid fa-circle-right"></i>
                        </div>
                        <div class="direction bottom" id="btnBottom"><i class="btnicon fa-solid fa-circle-down"></i>
                        </div>
                        <div class="direction left" id="btnLeft"><i class="btnicon fa-solid fa-circle-left"></i></div>
                    </div>
                </div>
            </div>
            <div id="CenterArea">
                <canvas id="myGame" width="994.667" height="547.556" id="574"></canvas>
            </div>
            <div id="RightArea">
                <canvas id="Heart" width="" height=""></canvas>
                <div id="PanelControl">
                    <div id="BtnSubmit">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../event/event.js"></script>
    <script>
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBall2(ball1);
            drawPaddleHorizontal();
            drawPaddleVertical(); // Thêm vẽ thanh đỡ dọc vào hàm draw
            ball1.x += ball1.dx;
            ball1.y += ball1.dy;

            // Xử lý va chạm với biên trái
            if (ball1.x + ball1.dx < ball1.ballRadius) {
                ball1.dx = -ball1.dx;
            }

            // Xử lý va chạm với biên phải
            if (ball1.x + ball1.dx > canvas.width - ball1.ballRadius) {
                if (ball1.y > paddleVertical && ball1.y < paddleVertical + paddleHeightVertical) {
                    // Xử lý khi quả bóng chạm thanh đỡ dọc
                    ball1.dx = -ball1.dx;
                } else {
                    // Xử lý khi quả bóng chạm biên phải
                    lives--;
                    if (!lives) {
                        alert("GAME OVER");
                        lives = 0;
                        clearInterval(BallFly);
                    } else {
                        ball1.x = canvas.width / 2;
                        ball1.y = canvas.height - 30;
                        ball1.dx = 3;
                        ball1.dy = -3;
                        paddleHorizontal = (canvas.width - paddleWidthHorizontal) / 2;
                        paddleVertical = (canvas.height - paddleHeightVertical) / 2;
                    }
                }
            }

            // Xử lý va chạm với biên trên
            if (ball1.y + ball1.dy < ball1.ballRadius) {
                ball1.dy = -ball1.dy;
            }

            // Xử lý va chạm với biên dưới và thanh đỡ
            if (ball1.y + ball1.dy > canvas.height - ball1.ballRadius - paddleHeightHorizontal + 10) {
                if (ball1.x > paddleHorizontal - ball1.ballRadius && ball1.x < paddleHorizontal + paddleWidthHorizontal + ball1.ballRadius) {
                    ball1.dy = -ball1.dy; // Xử lý va chạm với thanh đỡ ngang
                } else {
                    // Xử lý khi bóng chạm đáy và không chạm thanh đỡ
                    if (Math.abs(ball1.x - (paddleHorizontal + paddleWidthHorizontal / 2)) <= ball1.ballRadius &&
                    ball1.y + ball1.ballRadius >= canvas.height - paddleHeightHorizontal) {
                        ball1.dy = -ball1.dy; // Quả bóng nảy lại khi cách thanh đỡ 2 pixel ở mọi mặt
                    } else {
                        lives--;
                        if (!lives) {
                            alert("GAME OVER");
                            lives = 0;
                            clearInterval(BallFly);
                        } else {
                            ball1.x = canvas.width / 2;
                            ball1.y = canvas.height - 30;
                            ball1.dx = 3;
                            ball1.dy = -3;
                            paddleHorizontal = (canvas.width - paddleWidthHorizontal) / 2;
                            paddleVertical = (canvas.height - paddleHeightVertical) / 2;
                        }
                    }
                }
            }

            // Xử lý di chuyển của thanh đỡ ngang
            if (rightPressed && paddleHorizontal < canvas.width - paddleWidthHorizontal) {
                paddleHorizontal += 7;
            }
            else if (leftPressed && paddleHorizontal > 0) {
                paddleHorizontal -= 7;
            }

            // Xử lý di chuyển của thanh đỡ dọc
            if (rightPressed && paddleVertical < canvas.height - paddleHeightVertical) {
                paddleVertical += 3.4;
            }
            else if (leftPressed && paddleVertical > 0) {
                paddleVertical -= 3.4;
            }
            drawLives();
            drawBricksLV2();
            collisionDetection(ball1);
            drawScore();
        }
        animate();

    </script>
</body>

</html>